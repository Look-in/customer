package dao;

import entity.Item;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import static jdbc.JdbcConnect.connect;

public class SelectItemDao {

    public ArrayList<Item> readItem() throws SQLException {
        ArrayList<Item> items = new ArrayList<>();
         //Try с ресурсами закрывает коннект после заверш обработки запроса
        //На каждый запрос свой коннект, что замедляет работу
        try (Connection cn= connect()) {
                try (Statement st = cn.createStatement()) {
                    ResultSet rs = null;
                    try {
                         rs = st.executeQuery("SELECT " +
                                "item.ID,PRICE,NAME,DESCRIPTION,item_status.ID,STATUS" +
                                " FROM ITEM INNER JOIN " +
                                "item_status " +
                                "ON item.ITEM_STATUS_ID=item_status.ID; ");
                        while (rs.next()) {
                            Item tmpItem = new Item();
                            tmpItem.setItemId(rs.getInt(1));
                            tmpItem.setPrice(rs.getFloat(2));
                            tmpItem.setName(rs.getString(3));
                            tmpItem.setDescription(rs.getString(4));
                            tmpItem.setItemStatusId(rs.getInt(5));
                            tmpItem.setStatus(rs.getString(6));
                            items.add(tmpItem);
                        }
                     } catch (Exception exc) {
                        throw new RuntimeException(
                                "Error reading DB:" + exc.getMessage());
                    }
                    finally {if (rs != null) rs.close();
                    }

                    } catch (Exception exc) {
                        throw new RuntimeException("Satement can't closed: "+exc);
                    }
                } catch (Exception exc) {
                    System.err.println("Сonnection close error: " + exc);
                }

        return items;

    }
}
